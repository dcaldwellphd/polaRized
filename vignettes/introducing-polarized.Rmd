---
title: "Introducing polaRized: An R Package for Estimating Political Attitude Polarization in Complex Survey Data"
author: David Caldwell
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Introducing polaRized: An R Package for Estimating Political Attitude Polarization in Complex Survey Data}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

## Overview

This package makes it easy to apply various measures of attitude polarization across potentially many ordered ratings scales in complex survey data. The two main functions are `polarize_assoc` and `polarize_distr`, which return key associational and distributional statistics, respectively. The package also introduces some extensions to the `survey` package, enabling the incorporation of complex design features into the estimation of statistics commonly used to measure attitude polarization:

- `svykurt` calculates kurtosis.
- `svyskew` calculates standardized skewness.
- `svyextremism` calculates the proportion of extreme responses on ordered ratings scales with different lengths.

Additionally, two helper functions make it easier to prepare data prior to calculating polarization: `filter_scale_length` returns ordered ratings scales that meet a user-defined threshold of unique values, which is useful for statistics that require a certain scale length; `spread_pairs` takes a name key and value key and spreads these columns across unique pairs of observations, making it easier to estimate the association between responses on different survey items.

## Installation

The package can be installed directly from [GitHub](https://github.com/dcaldwellphd/polaRized).

```{r, message=FALSE, warning=FALSE, results = "hide", eval=FALSE}
pak::pak("dcaldwellphd/polaRized")

library(polaRized)
```

## Data prerequisites

Apart from the `svykurt`, `svyskew`, and `svyextremism`, which are general extensions to the `survey` package and designed to be called like any other function from that package, `polaRized` functions expect data to be stacked in a longer format. There should be a single value column or (for associational measures of polarization) pair of value columns containing observations across groups. The built-in data set (`toydata`) comes in this format.

```{r}
library(polaRized)

data(toydata)
head(toydata)
```

It has $n \times p$ rows recording the $nth$ respondent's rating on attitude item $p$. These values are stored in the name-value pair, `att_name` and `att_val`. The main functions from the `polaRized` package are designed to iterate over the `att_name` column, calculating statistics related to polarization using values in the `att_val` column.

## Describing attitude polarization using the `polaRized` package

Two main approaches to measuring attitude polarization are used in the political science literature: distributional and associational. These are the unifying themes of the two main functions implemented in this package: `polarize_distr` and `polarize_assoc`.

### Distributional measures and `polarize_distr`

Many studies summarize polarization through aspects of the distribution of public opinion surrounding political issues, such as the dispersion, multimodality, and extremism in attitudes [e.g., @Adams2012b; @DiMaggio1996; @Cohen2021]. The `polarize_distr` function provides many options for calculating these quantities, including the variance, standard deviation, interquartile range, kurtosis, and the proportion of extreme responses to ordered ratings scales. It can also return other statistics that do not directly measure distributional states of polarization but are useful for interpreting the changes causing them, i.e., the mean, median, and standardized skewness. Finally, the function also accepts methods for estimating consensus and disagreement on ordered rating scales from the the `agrmt` package, like van der Eijk's [-@VanDerEijk2001] agreement A.

Many of these statistics are sensitive to scale length or only make sense when a scale has so many unique values. Variance and standard deviation depend on the central tendency of a distribution, which is problematic for very short scales where values are likely to be clustered at one extreme. In some cases, the `polarize_distr` function fails when provided scales below a certain length. For instance, the `svyextremism` function from this package will not accept attitude items with fewer than four unique values, whereas van der Eijk's agreement A defines polarization by disaggregating response frequencies into "triples" deviating from or conforming to unimodality.^[Calling `agrmt::agrement` or `agrmt::polarization` on frequency vectors with a length below three returns `NA`] To help meet these requirements, `polaRized` includes a helper function designed to filter out attitude scales below a user-defined threshold: `filter_scale_length`. The default is to subset items with four or more unique values.

```{r}
length(unique(toydata$att_name))

# Remove the binary att2val variable from toydata
filtered_data <- filter_scale_length(
  toydata, 
  scale_names = att_name, 
  scale_values = att_val, 
  min_scale_length = 4
  )

length(unique(filtered_data$att_name))
```

Then it is safe to request one of these measures from the `polarize_distr` function. Hence, to get the standard deviation in attitudes by item, we call:

```{r}

polarize_distr(
  filtered_data,
  value = att_val,
  measure = "std",
  by = "att_name"
  )

```

The resulting output shows that the standard deviation is larger among longer ratings scales. If the goal is to compare the magnitude of these statistics across items with heterogeneous scale lengths, we can normalize on the fly using the `rescale_0_1` argument.

```{r}

polarize_distr(
  filtered_data,
  value = att_val,
  measure = "std",
  by = "att_name",
  rescale_0_1 = TRUE
  )

```

The `by` argument accepts multiple grouping variables, which is useful for comparing polarization in different populations:

```{r}

polarize_distr(
  filtered_data,
  value = att_val,
  measure = "std",
  by = c("att_name", "group"),
  rescale_0_1 = TRUE
  )

```

Leaving it `NULL` smooths across any grouping information contained in the data, resulting in a single value.

```{r}

polarize_distr(
  filtered_data,
  value = att_val,
  measure = "std",
  rescale_0_1 = TRUE
  )

```

### Associational measures and `polarize_assoc`

Distributional properties of polarization are intuitive, but much discussion of mass disagreement on political issues centers on associational measures [e.g., @Baldassarri2008]. For instance, partisan polarization on a political issue is the extent to which attitudes towards that issue are associated with partisanship. It is thus common to measure it using the Pearson correlation coefficient, especially two-party cases such as the United States [@Fiorina2008]. The built-in data for this package includes an ordinal party variable similar to the scale used to measure the strength of party identification in the US.

```{r}

unique(toydata$party_ord)

```

We can use the `polarize_assoc` function to get the Pearson correlation between this variable and attitudes on the different scales. Setting the `r_or_r2` argument to "r", we get:

```{r}

ap_r <- polarize_assoc(
  toydata,
  value_1 = att_val,
  value_2 = party_ord,
  r_or_r2 = "r",
  by = "att_name"
  )

ap_r

```

Many other countries have more than two large political parties, which are not necessarily ordered on a single dimension. This makes it difficult to measure partisan polarization without assuming that political disagreement operates along a left-right ideological continuum. However, @Caldwell2023 introduce a novel extension to associational measures of polarization that does not require this assumption. The $R^2$ from a linear regression model is the square of the correlation between observed and predicted outcomes. Given an OLS model predicting attitudes towards an issue from partisanship, it thus measures the extent to which different partisans hold different positions on that issue.

This approach to measuring polarization through the association between two sets of values is implemented by setting the `r_or_r2` argument to "r2" in the `polarize_assoc` function.

```{r}

ap_r2 <- polarize_assoc(
  toydata,
  value_1 = att_val,
  value_2 = party_ord,
  r_or_r2 = "r2",
  by = "att_name"
  )

ap_r2

```
 
The output returns the $R^2$ and adjusted $R^2$ from OLS models nested by any grouping information specified in the `by` argument.^[The adjusted $R^2$ is useful when comparing cases involving varying numbers of political parties, which affects the number of predictors in OLS models and the resulting $R^2$ statistic.] These statistics should be very similar to the absolute value of the square root of the correlation coefficient.

```{r, message=FALSE}

ap_r2 |> 
  dplyr::mutate(sqrt_r2 = sqrt(r2)) |> 
  dplyr::left_join(ap_r)

```

The intended use case of the $R^2$ approach is to measure the extent of association between attitudes and unordered party values. Consider the `party_cat` variable in the internal data set, which measures support for four parties on two dimensions.

```{r}

class(toydata$party_cat)
unique(toydata$party_cat)

```

To measure partisan polarization across these dimension, we pass `party_cat` to the `value_2` argument of the `polarize_assoc` function.

```{r}

polarize_assoc(
  toydata,
  value_1 = att_val,
  value_2 = party_cat,
  r_or_r2 = "r2",
  by = "att_name"
  )

```

Behind the scenes, `polarize_assoc` fits OLS models predicting `value_1` from $n-1$ dummy variables for the groups in `value_2`. It is thus important to use the `value_2` argument for unordered categorical predictors. However, in cases where both value columns have a numeric class, the direction of this relationship does not affect the $R^2$ statistics returned.

```{r, message=FALSE}

ap_r2 |> 
  dplyr::rename(att_party_r2 = r2) |>
  dplyr::select(-adj_r2) |>
  dplyr::left_join(
    polarize_assoc(
      toydata,
      value_1 = party_ord,
      value_2 = att_val,
      r_or_r2 = "r2",
      by = "att_name"
      )
    ) |> 
  dplyr::rename(party_att_r2 = r2) |>
  dplyr::select(-adj_r2)

```

Another application for associational measures is the correlation between attitudes on pairs of political issues, which is commonly used to capture ideological polarization [e.g., @Baldassarri2008; @Caldwell2023; @Munzert2013]. The `polaRized` package includes a helper function to get data like `toydata` into the format required by the `polarize_assoc` function.

```{r}

paired_toydata <- spread_pairs(
  toydata, 
  name_key = att_name, 
  value_key = att_val, 
  other_keys = c("id", "group")
  )

paired_toydata

```

The `spread_pairs` function spreads a name-value key across unique pairs of observations, so that the two resulting value columns can be used to calculate associational measures of polarization by observed combinations of attitude item.

```{r}

polarize_assoc(
  paired_toydata,
  value_1 = att_val1,
  value_2 = att_val2,
  r_or_r2 = "r",
  by = c("att_name1", "att_name2")
  )

```

## Use of the `survey` package

`polaRized` is designed to work through the `survey` package. What `polarize_distr` and `polarize_assoc` do is iterate over groups supplied to the `by` argument and calculate statistics on individual \code{survey.design} objects. Both functions take many arguments from `survey::svydesign` as implemented in the `srvyr` package, meaning that these arguments do not need to be supplied as a formula (i.e., "~ <design_feature>"). The internal data set includes an artificial weight column to demonstrate this feature.

```{r}

polarize_distr(
  toydata,
  value = att_val,
  measure = "std",
  by = "att_name",
  weights = weight
)

```

The `polaRized` package adds its own extensions to the survey package



